<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ´ªé‚¦å®‡é”™è¯ç»Ÿè®¡å°å·¥å…·</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f7;
    }
    h1 {
      margin-top: 0;
      font-size: 22px;
    }
    .container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    .panel {
      background: #ffffff;
      border-radius: 10px;
      padding: 16px 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .left-panel {
      flex: 0 0 340px;
    }
    .right-panel {
      flex: 1;
      max-height: 80vh;
      overflow: auto;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      color: #555;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-primary {
      background: #4a90e2;
      color: #fff;
    }
    .btn-secondary {
      background: #eee;
      color: #333;
      margin-left: 6px;
    }
    .btn-mini {
      padding: 4px 8px;
      font-size: 12px;
    }
    .stats {
      margin-top: 16px;
      font-size: 14px;
      color: #444;
      line-height: 1.6;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
    }
    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      position: sticky;
      top: 0;
      background: #fafafa;
      z-index: 1;
    }
    tr:nth-child(even) td {
      background-color: #fcfcfc;
    }
    .count-cell {
      text-align: center;
      width: 80px;
    }
    .word-cell {
      font-weight: 500;
    }
    .badge-zero {
      font-size: 12px;
      color: #999;
    }
    .btn-group {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .hint {
      margin-top: 8px;
      font-size: 12px;
      color: #888;
    }
  </style>
</head>
<body>

  <h1>å­¦ç”Ÿé”™è¯ç»Ÿè®¡å°å·¥å…·</h1>

  <div class="container">
    <!-- å·¦ä¾§ï¼šå½•å…¥åŒº -->
    <div class="panel left-panel">
      <label for="wordInput">é‡åˆ°ä¸ä¼šçš„å•è¯æ—¶ï¼Œåœ¨è¿™é‡Œè¾“å…¥ï¼ˆå»ºè®®ç”¨å°å†™ï¼‰ï¼š</label>
      <input id="wordInput" type="text" placeholder="ä¾‹å¦‚ï¼šachieve">
      <div class="hint">ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥è¿™ä¸ªå•è¯æ˜¯å¦åœ¨åŸºç¡€å•è¯è¡¨é‡Œï¼Œé˜²æ­¢ä½ è¾“é”™ã€‚</div>

      <div class="btn-group">
        <button id="recordBtn" class="btn-primary">è®°å½•ä¸€æ¬¡</button>
        <button id="addFromListBtn" class="btn-secondary">åˆå§‹åŒ–åŸºç¡€å•è¯è¡¨</button>
        <button id="resetBtn" class="btn-secondary">æ¸…ç©ºæ‰€æœ‰ç»Ÿè®¡</button>
      </div>

      <div class="btn-group">
        <button id="exportBtn" class="btn-secondary">å¯¼å‡ºæ•°æ®(JSON)</button>
        <button id="importBtn" class="btn-secondary">å¯¼å…¥æ•°æ®(JSON)</button>
        <!-- éšè—çš„æ–‡ä»¶é€‰æ‹©æ¡†ï¼Œç”¨äºå¯¼å…¥ -->
        <input id="importFileInput" type="file" accept="application/json" style="display:none;">
      </div>

      <div class="stats">
        <div>ğŸ“Š æ€»å…±è®°å½•æ¬¡æ•°ï¼š<span id="totalTimes">0</span></div>
        <div>ğŸ“š ä¸åŒé—®é¢˜å•è¯æ•°é‡ï¼š<span id="uniqueWords">0</span></div>
        <div>â­ è¡¨æ ¼æŒ‰ã€Œæ¬¡æ•°ã€ä»é«˜åˆ°ä½æ’åºï¼Œæ–¹ä¾¿ä½ çœ‹åˆ°æœ€å¸¸é”™çš„å•è¯ã€‚</div>
      </div>
    </div>

    <!-- å³ä¾§ï¼šç»Ÿè®¡è¡¨ -->
    <div class="panel right-panel">
      <table>
        <thead>
        <tr>
          <th style="width: 60px;">åºå·</th>
          <th>å•è¯</th>
          <th class="count-cell">æ¬¡æ•°</th>
          <th style="width: 100px;">æ“ä½œ</th>
        </tr>
        </thead>
        <tbody id="wordTableBody">
        <!-- JS åŠ¨æ€å¡«å…… -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // åŸºç¡€å•è¯åˆ—è¡¨ï¼ˆå¯æŒ‰ä½ çš„éœ€è¦æ”¹ï¼‰
    const baseWordList = [
      "above","aboard","account","achieve","active","address","allow","along","ancient",
      "another","answer","apartment","argue","athlete","attend","aunt","average","aware",
      "balloon","bean","beat","before","behave","bell","belong","below","benefit","beside",
      "bill","bin","biology","biscuit","block","blow","borrow","both","button","brain",
      "breath","bright","brush","bully","burn","calm","cancel","capital","case","cash",
      "cause","certain","chance","character","circle","click","close","coach","coat",
      "collect","compare","concert","condition","connect","consider","cooperate","cost",
      "count","courage","course","cover","degree","describe","design","diet","direct",
      "disappoint","discover","discuss","divide","donate","during","eagle","effect",
      "electric","encourage","era","event","except","expect","expert","explain","explore",
      "factory","fail","false","familiar","fear","field","fit","flood","fog","force","fork",
      "form","forward","freeze","front","gas","glove","grape","grass","greet","guess",
      "guest","guide","hardly","hear","heat","height","however","hunt","impossible",
      "improve","include","influence","information","instead","instruction","interest",
      "introduce","jog","kind","lonely","mad","magazine","manner","mark","material",
      "medal","medical","mess","message","method","must","mutton","narrow","nature",
      "necessary","negative","nervous","nod","nose","ocean","offer","operate","opinion",
      "order","oven","own","packet","pain","pair","palace","paragraph","parent",
      "passenger","past","percent","perform","perhaps","person","pick","picnic","pill",
      "pilot","pioneer","planet","plant","pleasure","poem","pool","population","porridge",
      "praise","prepare","president","pretty","price","pride","prince","private","prize",
      "product","promise","proper","protect","prove","publish","punish","purple","purpose",
      "quality","rainbow","real","reason","receive","result","review","rocket","rope",
      "round","satisfy","scare","scarf","scissors","search","season","seat","secret",
      "seldom","send","separate","shape","shelf","ship","shock","shower","sick","side",
      "similar","single","ski","slim","social","society","sock","soil","solve","soon",
      "sound","spell","spend","stage","stamp","straight","succeed","suggest","support",
      "survey","service","sweater","talent","tap","task","therefore","thick","though",
      "throat","through","tie","tiny","tour","toward","tower","translate","treasure",
      "trousers","trust","understand","uniform","universe","usual","value","victory",
      "virus","voluntary","vote","wake","waste","wave","weak","weigh","way","whale",
      "wheel","whether","while","whole","wide","wild","wise","wish","wonder","worse",
      "wound","yogurt"
    ];

    const baseWordSet = new Set(baseWordList); // ç”¨æ¥å¿«é€Ÿæ£€æŸ¥æ˜¯å¦åœ¨è¯è¡¨é‡Œ

    // å­˜å‚¨ç»“æ„ï¼š { å•è¯: æ¬¡æ•°, ... }
    let wordStats = {};

    const STORAGE_KEY = "student_wrong_word_stats_v1";

    function loadFromStorage() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          wordStats = JSON.parse(raw) || {};
        } catch (e) {
          wordStats = {};
        }
      } else {
        wordStats = {};
      }
      renderTableAndStats();
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(wordStats));
    }

    // åˆå§‹åŒ–åŸºç¡€å•è¯è¡¨ï¼ˆæ‰€æœ‰æ¬¡æ•°ä¸º 0ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¸è¦†ç›–æ¬¡æ•°ï¼‰
    function initBaseWords() {
      baseWordList.forEach(w => {
        const word = w.trim().toLowerCase();
        if (!word) return;
        if (wordStats[word] == null) {
          wordStats[word] = 0;
        }
      });
      saveToStorage();
      renderTableAndStats();
      alert("åŸºç¡€å•è¯è¡¨å·²å†™å…¥ï¼ˆä¸ä¼šè¦†ç›–å·²æœ‰ç»Ÿè®¡ï¼‰ã€‚");
    }

    // Levenshtein è·ç¦»ï¼Œç”¨æ¥ç»™ä½ æ™ºèƒ½æ¨èâ€œä½ æ˜¯ä¸æ˜¯æƒ³è¾“å…¥â€¦â€¦â€
    function levenshtein(a, b) {
      const m = a.length;
      const n = b.length;
      const dp = Array.from({ length: m + 1 }, () => new Array(n + 1).fill(0));

      for (let i = 0; i <= m; i++) dp[i][0] = i;
      for (let j = 0; j <= n; j++) dp[0][j] = j;

      for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
          const cost = a[i - 1] === b[j - 1] ? 0 : 1;
          dp[i][j] = Math.min(
            dp[i - 1][j] + 1,     // åˆ é™¤
            dp[i][j - 1] + 1,     // æ’å…¥
            dp[i - 1][j - 1] + cost // æ›¿æ¢
          );
        }
      }
      return dp[m][n];
    }

    // æ ¹æ®è¾“å…¥çš„å•è¯ï¼Œæ‰¾å‡ ä¸ªâ€œæœ€åƒâ€çš„å€™é€‰
    function getSuggestions(word) {
      const candidates = [];
      baseWordList.forEach(w => {
        if (Math.abs(w.length - word.length) > 2) return; // å¤ªé•¿æˆ–å¤ªçŸ­å°±è·³è¿‡ï¼Œæé€Ÿä¸€ç‚¹
        const dist = levenshtein(word, w);
        if (dist <= 2) { // ç¼–è¾‘è·ç¦»å°äºç­‰äº2ï¼Œä¸€èˆ¬å°±æ˜¯è½»å¾®æ‹¼å†™é”™è¯¯
          candidates.push({ w, dist });
        }
      });
      candidates.sort((a, b) => a.dist - b.dist);
      return candidates.slice(0, 3).map(item => item.w); // åªå–å‰ä¸‰ä¸ª
    }

    // çœŸçš„æ‰§è¡Œä¸€æ¬¡ +1ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰
    function reallyRecordWord(word) {
      if (!wordStats[word]) {
        wordStats[word] = 0;
      }
      wordStats[word] += 1;
      saveToStorage();
      renderTableAndStats();
    }

    // ä»è¾“å…¥æ¡†è®°å½•ä¸€æ¬¡ï¼ˆå¸¦æ‹¼å†™æ£€æŸ¥ï¼‰
    function recordWordFromInput() {
      const input = document.getElementById("wordInput");
      const rawWord = input.value;
      const word = rawWord.trim().toLowerCase();
      if (!word) return;

      // æ‹¼å†™æ£€æŸ¥ï¼šä¸åœ¨åŸºç¡€å•è¯è¡¨é‡Œ â†’ æç¤º + å€™é€‰
      if (!baseWordSet.has(word)) {
        const suggestions = getSuggestions(word);
        let msg = `âš ï¸ "${word}" ä¸åœ¨åŸºç¡€å•è¯è¡¨é‡Œï¼Œå¯èƒ½æ‹¼é”™äº†ã€‚\n`;
        if (suggestions.length > 0) {
          msg += "\nä½ æ˜¯ä¸æ˜¯æƒ³è¾“å…¥ï¼š\n" + suggestions.map(w => "  - " + w).join("\n") + "\n";
        }
        msg += "\nã€ç¡®å®šã€‘ä»ç„¶æŒ‰ \"" + word + "\" è®°å½•ä¸€æ¬¡\nã€å–æ¶ˆã€‘è¿”å›ä¿®æ”¹";

        const ok = confirm(msg);
        if (!ok) {
          // ä¸è®°å½•ï¼Œè¿”å›è®©ä½ ä¿®æ”¹
          input.focus();
          return;
        }
      }

      reallyRecordWord(word);
      input.value = "";
      input.focus();
    }

    // æ¸…ç©ºæ‰€æœ‰
    function resetAll() {
      if (!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ")) return;
      wordStats = {};
      saveToStorage();
      renderTableAndStats();
    }

    // å¯¼å‡ºæ•°æ®ä¸º JSON æ–‡ä»¶
    function exportData() {
      const dataStr = JSON.stringify(wordStats, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const dateStr = new Date().toISOString().slice(0,10); // yyyy-mm-dd
      a.href = url;
      a.download = "word_stats_" + dateStr + ".json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ä» JSON æ–‡ä»¶å¯¼å…¥æ•°æ®
    function importDataFromFile(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const obj = JSON.parse(e.target.result);
          if (obj && typeof obj === "object" && !Array.isArray(obj)) {
            wordStats = obj;
            saveToStorage();
            renderTableAndStats();
            alert("æ•°æ®å¯¼å…¥æˆåŠŸï¼");
          } else {
            alert("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œæ— æ³•å¯¼å…¥ã€‚");
          }
        } catch (err) {
          alert("è§£æ JSON å¤±è´¥ï¼Œè¯·ç¡®è®¤æ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€‚");
        }
      };
      reader.readAsText(file, "utf-8");
    }

    // æ¸²æŸ“è¡¨æ ¼å’Œç»Ÿè®¡ä¿¡æ¯
    function renderTableAndStats() {
      const tbody = document.getElementById("wordTableBody");
      tbody.innerHTML = "";

      const entries = Object.entries(wordStats); // [ [word, count], ... ]

      // ç»Ÿè®¡æ•°æ®
      let totalTimes = 0;
      let uniqueWords = 0;
      entries.forEach(([w, c]) => {
        if (c > 0) {
          totalTimes += c;
          uniqueWords += 1;
        }
      });

      document.getElementById("totalTimes").textContent = totalTimes;
      document.getElementById("uniqueWords").textContent = uniqueWords;

      // æ’åºï¼šæŒ‰æ¬¡æ•°ä»é«˜åˆ°ä½ï¼›åŒæ¬¡æ•°æŒ‰å­—æ¯æ’åº
      entries.sort((a, b) => {
        if (b[1] !== a[1]) return b[1] - a[1];
        return a[0].localeCompare(b[0]);
      });

      entries.forEach(([word, count], index) => {
        const tr = document.createElement("tr");

        const tdIndex = document.createElement("td");
        tdIndex.textContent = index + 1;
        tr.appendChild(tdIndex);

        const tdWord = document.createElement("td");
        tdWord.textContent = word;
        tdWord.className = "word-cell";
        tr.appendChild(tdWord);

        const tdCount = document.createElement("td");
        tdCount.className = "count-cell";
        tdCount.textContent = count;
        if (count === 0) {
          tdCount.innerHTML = '<span class="badge-zero">0</span>';
        }
        tr.appendChild(tdCount);

        const tdActions = document.createElement("td");
        const btnPlus = document.createElement("button");
        btnPlus.textContent = "+1";
        btnPlus.className = "btn-mini btn-secondary";
        btnPlus.addEventListener("click", () => {
          reallyRecordWord(word);
        });
        tdActions.appendChild(btnPlus);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
      });
    }

    // äº‹ä»¶ç»‘å®š
    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("wordInput");
      const recordBtn = document.getElementById("recordBtn");
      const resetBtn = document.getElementById("resetBtn");
      const addFromListBtn = document.getElementById("addFromListBtn");
      const exportBtn = document.getElementById("exportBtn");
      const importBtn = document.getElementById("importBtn");
      const importFileInput = document.getElementById("importFileInput");

      loadFromStorage();

      recordBtn.addEventListener("click", () => {
        recordWordFromInput();
      });

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          recordWordFromInput();
        }
      });

      resetBtn.addEventListener("click", resetAll);
      addFromListBtn.addEventListener("click", initBaseWords);

      exportBtn.addEventListener("click", exportData);

      importBtn.addEventListener("click", () => {
        importFileInput.value = "";
        importFileInput.click();
      });

      importFileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        importDataFromFile(file);
      });
    });
  </script>
</body>
</html>
